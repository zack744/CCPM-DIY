# CCPM 最佳实践指南

> 基于实际使用经验的完整工作流程指南

## 📖 文档说明

本文档基于真实用户使用 CCPM 系统的对话记录整理，涵盖了从系统理解到实际操作的完整流程。

---

## 🎯 核心概念理解

### 什么是 CCPM？

CCPM (Claude Code Project Manager) 是一个基于 Claude Code 的项目管理系统，它的核心创新在于：

1. **并行 AI 代理执行** - 多个代理同时工作，而不是串行执行
2. **规范驱动开发** - PRD → Epic → Tasks → Issues → Code 的完整可追溯链条
3. **GitHub 原生集成** - 无缝对接现有开发工具链
4. **上下文保护机制** - 通过代理隔离避免主对话信息过载

### 系统架构的"三层魔法"

```
第1层：你的对话框 (指挥中心)
├── 🎯 下达命令，查看状态
├── 📊 监控所有任务进度  
└── 🎮 管理多个Epic和Issue

第2层：隐身代理们 (并行工作者)
├── 👷 在不同工作树中干活
├── 🤖 自动执行，不占用对话空间
└── 📝 定期更新进度

第3层：Git工作树 (实际工作空间)
├── 📁 ../epic-auth/ - 认证功能代理工作区
├── 📁 ../epic-orders/ - 订单功能代理工作区
└── 📁 ../epic-payment/ - 支付功能代理工作区
```

---

## 🔧 常见困惑解答

### Q: 为什么看不到代理修改的代码？

**A: 代码在"隐身工作间"里！**

代理们在独立的 Git 工作树中工作，代码修改不会直接出现在主项目目录：

```bash
# 主项目目录 (你看到的)
C:\your-project\
├── src/          # 这里看不到修改
└── README.md

# 工作树目录 (代理工作的地方)
C:\epic-功能名\
├── src/          # 代理在这里修改代码!
└── README.md     # 修改都在这里!
```

**验证方法：**
```bash
# 查看工作树
git worktree list

# 进入工作树查看
cd ../epic-功能名
ls -la            # 看到修改的文件
git log --oneline  # 看到代理的提交记录
```

### Q: 代理工作完成但没有提交代码？

**A: 这是系统的一个已知问题，现已修复！**

**问题原因：**
- 代理被告知"频繁提交"但缺少明确的最终提交指令
- 没有验证机制确保代理真的推送了代码
- 依赖隐式行为而不是明确指示

**修复方案：**
系统已更新代理指令，现在代理会：
1. ✅ 频繁提交工作进度
2. ✅ 完成时推送到远程分支
3. ✅ 验证 git 状态确保干净
4. ✅ 报告提交状态包括 SHA 和推送结果

### Q: 主分支和Epic分支会冲突吗？

**A: 完全不会！它们是独立的平行宇宙**

```bash
# 分支隔离机制
主分支推送: git push origin main
Epic分支推送: git push origin epic/功能名

# 两者完全独立，互不影响！
```

**合并时机：**
- Epic完成后使用 `/pm:epic-merge 功能名` 合并
- 系统会自动处理冲突检测和解决
- 合并后自动清理工作树和分支

---

## 🚀 完整工作流程

### 1. 初始化项目

```bash
# 安装系统到项目
git clone https://github.com/zack744/CCPM-DIY.git ccpm-temp
cp -r ccpm-temp/.claude path/to/your/project/
rm -rf ccpm-temp

# 初始化PM系统
/pm:init

# 创建项目上下文
/context:create
```

### 2. 创建功能开发计划

```bash
# 创建产品需求文档
/pm:prd-new 功能名称

# 转换为技术实施计划
/pm:prd-parse 功能名称

# 分解为具体任务并同步到GitHub
/pm:epic-oneshot 功能名称
```

### 3. 并行开发执行

```bash
# 启动第一个功能
/pm:issue-start 1235
# ✅ 启动3个代理在 ../epic-auth/ 工作

# 同时启动第二个功能
/pm:issue-start 1236
# ✅ 启动2个代理在 ../epic-orders/ 工作

# 再启动第三个功能
/pm:issue-start 1237
# ✅ 启动4个代理在 ../epic-payment/ 工作

# 现在你有9个代理在3个独立工作树中并行工作！
```

### 4. 进度监控和管理

```bash
# 总览所有项目状态
/pm:status

# 查看每日站会报告
/pm:standup

# 同步特定任务进度到GitHub
/pm:issue-sync 1235

# 查看具体Epic详情
/pm:epic-show auth
```

### 5. 完成和合并

```bash
# 任务完成后合并到主分支
/pm:epic-merge auth
# ✅ 自动合并、清理工作树、关闭Issues

# 检查其他任务状态
/pm:issue-sync 1236

# 继续合并已完成的功能
/pm:epic-merge orders
```

---

## 💡 高级技巧

### 单对话框管理多任务

你可以在**一个 Claude Code 对话框**中管理多个并行任务：

```bash
# 实际工作流示例 (全程在一个对话框)
你: /pm:issue-start 123  # 启动用户认证
Claude: ✅ 启动了3个代理

你: /pm:issue-start 456  # 同时启动订单系统  
Claude: ✅ 启动了2个代理

你: /pm:issue-start 789  # 再启动支付功能
Claude: ✅ 启动了4个代理

你: /pm:status          # 查看全局状态
Claude: 📊 3个Epic进行中，9个代理活跃

你: /pm:epic-merge auth # 第一个完成，合并
Claude: ✅ 已合并到主分支
```

### 优势对比

**❌ 传统方式：**
```
终端1: Claude Code → 处理认证功能
终端2: Claude Code → 处理订单功能  
终端3: Claude Code → 处理支付功能
```
- 💸 消耗3倍资源
- 🤯 需要在3个窗口间切换
- 😵 上下文分散，难以协调

**✅ CCPM方式：**
```
终端1: Claude Code → 指挥所有功能
  ├── 代理群A在 ../epic-auth/ 干活
  ├── 代理群B在 ../epic-orders/ 干活
  └── 代理群C在 ../epic-payment/ 干活
```
- 💪 一个对话框管理全部
- 🎯 统一的上下文和协调
- ⚡ 真正的并行开发

---

## 🛠️ 时间戳配置

### 修改为北京时间

系统默认使用 UTC 时间，可修改为北京时间：

**修改文件：** `.claude/rules/datetime.md`

**关键更改：**
```bash
# 从 UTC 格式
date -u +"%Y-%m-%dT%H:%M:%SZ"
# 改为北京时间格式  
TZ='Asia/Shanghai' date +"%Y-%m-%dT%H:%M:%S+08:00"
```

**影响范围：**
- PRD 创建时间
- Epic 和任务的创建/更新时间  
- 进度同步时间
- 日志记录时间

---

## 📊 监控和调试

### 常用监控命令

```bash
# 总览命令
/pm:status           # 查看所有项目状态
/pm:standup          # 生成日报(所有Epic)
/pm:blocked          # 查看所有阻塞任务
/pm:in-progress      # 查看进行中的工作

# 针对性管理
/pm:epic-show auth   # 查看认证Epic详情
/pm:issue-sync 123   # 同步特定Issue
/pm:epic-merge orders # 合并完成的Epic
```

### 问题排查

**工作树检查：**
```bash
git worktree list           # 查看所有工作树
cd ../epic-功能名            # 进入具体工作树
git log --oneline -10       # 查看代理提交记录
git status                  # 检查工作状态
```

**代理状态检查：**
```bash
ls .claude/epics/功能名/updates/  # 查看进度文件
cat .claude/epics/功能名/updates/123/stream-A.md  # 查看具体代理进度
```

---

## 🎯 角色转换

### 从程序员到项目经理

使用 CCPM 后，你的角色发生根本转变：

**❌ 以前 (程序员)：**
- 写具体代码
- 处理技术细节
- 串行完成任务
- 管理单一上下文

**✅ 现在 (项目经理)：**
- 规划功能和任务
- 监控进度和质量
- 协调并行资源
- 管理多个项目

### 就像指挥交响乐团 🎼

- 🎻 小提琴组(前端代理) - 处理UI
- 🎺 铜管组(后端代理) - 处理API  
- 🥁 打击乐组(测试代理) - 质量保证
- 🎯 **你是指挥** - 在一个位置协调全部

---

## 🚀 最终效果

**一个对话框 = 一个软件公司**

- ✅ 多个项目并行开发
- ✅ 十几个"员工"(代理)同时工作
- ✅ 实时进度监控
- ✅ 统一质量管控
- ✅ 自动化交付流程
- ✅ 完整的审计跟踪

**效率提升数据：**
- 89% 减少上下文切换时间
- 5-8 个并行任务 vs 之前的 1 个
- 75% 减少 bug 率
- 高达 3 倍更快的功能交付

---

## 📝 注意事项

### 安全提醒

1. **仓库保护** - 系统会检查是否在模板仓库中操作
2. **权限验证** - 确保 GitHub CLI 已正确配置
3. **备份重要** - 合并前建议备份重要分支

### 最佳实践

1. **频繁同步** - 定期运行 `/pm:issue-sync` 更新进度
2. **及时合并** - Epic 完成后尽快合并避免冲突
3. **状态监控** - 使用 `/pm:status` 保持全局视野
4. **测试验证** - 合并前运行测试确保质量

---

## 🎉 总结

CCPM 系统的核心价值在于：

1. **真正的并行开发** - 多代理同时工作，不是排队等待
2. **上下文保护** - 主对话保持清洁，专注于管理
3. **完整的可追溯性** - 从需求到代码的完整链条
4. **无缝团队协作** - GitHub 集成让团队实时可见

这不仅仅是一个工具，更是一种全新的软件开发模式 - 让你从写代码的程序员升级为管理项目的架构师！

---

*最后更新：2025年9月*  
*基于 CCPM-DIY 项目实际使用经验整理*