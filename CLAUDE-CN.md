# CLAUDE.md

> 仔细思考并实现最简洁的解决方案，尽可能少地更改代码。

## 使用子代理优化上下文

### 1. 当被要求读取文件时，始终使用文件分析子代理。
文件分析代理是从文件中提取和总结关键信息的专家，特别是日志文件和详细输出。它提供简洁、可操作的摘要，在保留重要信息的同时大幅减少上下文使用。

### 2. 当被要求搜索代码、分析代码、研究错误或跟踪逻辑流程时，始终使用代码分析子代理。

代码分析代理是代码分析、逻辑跟踪和漏洞检测的专家。它提供简洁、可操作的摘要，在保留重要信息的同时大幅减少上下文使用。

### 3. 始终使用测试运行子代理来运行测试并分析测试结果。

使用测试运行代理确保：

- 完整捕获测试输出用于调试
- 主对话保持清洁和专注
- 上下文使用得到优化
- 所有问题都得到适当的反映
- 没有批准对话框中断工作流程

## 理念

### 错误处理

- **快速失败**用于关键配置（缺少文本模型）
- **记录并继续**用于可选功能（提取模型）
- **优雅降级**当外部服务不可用时
- **用户友好的消息**通过弹性层

### 测试

- 始终使用测试运行代理执行测试。
- 永远不要为任何东西使用模拟服务。
- 在当前测试完成之前不要继续下一个测试。
- 如果测试失败，在决定需要重构代码库之前，考虑检查测试是否结构正确。
- 测试要详细，以便我们可以用它们进行调试。


## 语调和行为

- 欢迎批评。请告诉我什么时候我错了或弄错了，甚至当你认为我可能错了或弄错了时。
- 如果有比我采用的方法更好的方法，请告诉我。
- 如果有我似乎不知道的相关标准或约定，请告诉我。
- 保持怀疑。
- 简洁明了。
- 简短的摘要是可以的，但除非我们正在制定计划的细节，否则不要给出详细的分解。
- 不要奉承，不要给予赞美，除非我特别要求你的判断。
- 偶尔的寒暄是可以的。
- 随时提出问题。如果你对我的意图有疑问，不要猜测。直接问。

## 绝对规则：

- 不允许部分实现
- 不允许简化：不要"这是目前简化的内容，完整实现将会blablabla"
- 不允许代码重复：检查现有代码库以重用函数和常量。在编写新函数之前读取文件。使用常识性函数名称来轻松找到它们。
- 不允许死代码：要么使用，要么从代码库中完全删除
- 为每个函数实现测试
- 不允许作弊测试：测试必须准确，反映实际使用情况，并设计为揭示缺陷。不要无用的测试！设计测试要详细，以便我们可以用它们进行调试。
- 不允许不一致的命名 - 阅读现有代码库命名模式。
- 不允许过度工程 - 当简单函数就能工作时，不要添加不必要的抽象、工厂模式或中间件。当你需要"工作"时，不要想"企业级"
- 不允许混合关注点 - 不要将验证逻辑放在API处理程序中，将数据库查询放在UI组件中等，而不是适当的分离
- 不允许资源泄漏 - 不要忘记关闭数据库连接、清除超时、移除事件监听器或清理文件句柄