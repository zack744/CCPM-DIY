● 问题诊断：上下文丢失的根本原因

  你遇到的问题说明了一个关键点：仅仅安装 CCPM 工具不等于正确使用 CCPM 系统。让我分析可能的原因：

  🚨 常见错误模式

  1. 跳过了关键的上下文建立步骤
    - 没有运行 /context:create 建立项目基线
    - 没有使用 /context:prime 在每次会话开始时加载上下文
  2. 没有遵循规范驱动的工作流
    - 直接开始编程而不是先写 PRD
    - 缺少从需求到实施的完整链路
  3. 上下文更新不及时
    - 重大修改后没有运行 /context:update
    - 没有及时同步项目状态

  💡 正确的 CCPM 上下文管理流程

  让我为你的 AI 头像项目演示正确的设置方法：

● Update Todos
  ⎿  ☒ 分析用户项目中上下文丢失的根本原因
     ☐ 提供CCPM上下文管理的最佳实践
     ☐ 演示如何正确设置和维护项目上下文
     ☐ 制定防止代码混乱的工作流程

● 第一步：建立完整的项目上下文

  # 1. 初始化并创建项目基线上下文
  /context:create

  # 2. 为项目重构创建 PRD
  /pm:prd-new ai-image-generator-refactor

  # 在 PRD 中明确说明：
  # - 当前项目状态（专业头像生成）
  # - 目标状态（通用图片生成）
  # - 保留的功能模块
  # - 需要修改的部分
  # - 架构变更要求

  第二步：规范化重构流程

  # 3. 将 PRD 转换为技术实施计划
  /pm:prd-parse ai-image-generator-refactor

  # 4. 分解为具体任务
  /pm:epic-decompose ai-image-generator-refactor

  # 5. 同步到 GitHub 进行跟踪
  /pm:epic-sync ai-image-generator-refactor

  第三步：每次会话的标准开始流程

  # 每次重新开始工作时，必须执行：
  /context:prime          # 加载项目上下文
  /pm:status             # 查看当前项目状态
  /pm:next               # 获取下一个优先任务

  🛡️ 防止代码混乱的关键策略

● Update Todos
  ⎿  ☒ 分析用户项目中上下文丢失的根本原因
     ☒ 提供CCPM上下文管理的最佳实践
     ☐ 演示如何正确设置和维护项目上下文
     ☐ 制定防止代码混乱的工作流程

● 1. 严格的上下文生命周期管理

  在任何重大修改前：
  # 保存当前状态
  /pm:sync                     # 同步所有进度到 GitHub
  /context:update              # 更新上下文文档

  # 创建检查点
  git add . && git commit -m "重构前检查点：保存专业头像功能状态"

  重大修改期间：
  # 每完成一个模块修改
  /pm:issue-sync [issue-id]    # 立即同步进度
  /context:update              # 更新上下文反映变更

  # 每日结束工作时
  /pm:standup                  # 生成当日工作总结

  2. 分阶段重构策略

  # 第一阶段：保持功能，扩展架构
  /pm:issue-start [架构扩展-issue-id]

  # 第二阶段：逐步迁移功能
  /pm:issue-start [功能迁移-issue-id]

  # 第三阶段：清理和优化
  /pm:issue-start [代码清理-issue-id]

  3. 关键检查点

  在每个阶段完成后运行：
  /pm:validate                 # 检查系统完整性
  /pm:epic-refresh [epic-name] # 刷新史诗进度

  🔧 具体修复建议

  对于你当前的项目，我建议：

● Update Todos
  ⎿  ☒ 分析用户项目中上下文丢失的根本原因
     ☒ 提供CCPM上下文管理的最佳实践
     ☒ 演示如何正确设置和维护项目上下文
     ☐ 制定防止代码混乱的工作流程

● 立即行动计划

  1. 回到稳定状态
  # 回滚到最后一个稳定版本
  git log --oneline           # 找到稳定版本的 commit
  git reset --hard [commit-id] # 回滚到稳定状态

  2. 正确设置 CCPM
  # 如果还没有，先安装 CCPM
  /pm:init                    # 初始化系统
  /context:create             # 建立项目基线
  /re-init                    # 确保 CLAUDE.md 正确配置

  3. 规范化重构流程
  # 创建重构 PRD
  /pm:prd-new ai-avatar-to-general-images

  # 在 PRD 中详细描述：
  # - 当前专业头像功能的完整状态
  # - 目标通用图片生成功能
  # - 保留/修改/新增的模块
  # - 数据迁移策略
  # - 用户界面变更
  # - API 接口调整

  4. 建立工作检查清单

  每次会话开始前：
  - /context:prime - 加载项目上下文
  - /pm:status - 检查项目状态
  - 阅读最近的 /pm:standup 报告

  重大修改前：
  - 创建 git 分支
  - /context:update - 更新当前状态
  - 明确修改范围和预期结果

  每个功能完成后：
  - /pm:issue-sync [id] - 同步进度
  - 运行测试确保功能正常
  - 提交代码并添加清晰的 commit 信息




   首先，切换到你的 AI 图片生成项目目录：

  cd /path/to/your/ai-image-project

  第二步：安装 CCPM 系统

  由于你在 Windows 系统，使用 PowerShell 执行：

  # 下载并安装 CCPM
  iwr -useb https://raw.githubusercontent.com/automazeio/ccpm/main/ccpm.bat | iex

  这会在你的项目中创建 .claude/ 目录和所有必要的文件。

  第三步：初始化 CCPM 系统

  # 初始化项目管理系统
  /pm:init

  这个命令会：
  - 安装 GitHub CLI（如果需要）
  - 配置 GitHub 身份验证
  - 安装必要的扩展
  - 创建目录结构
  - 更新 .gitignore

  第四步：建立项目基础上下文

  # 创建项目基线上下文
  /context:create

  # 初始化 CLAUDE.md 配置
  /re-init

  这是关键步骤！/context:create 会分析你的项目结构，创建完整的项目上下文文档，这样 Claude 就能记住你的项目状态。

  第五步：加载项目上下文

  # 加载上下文到当前会话
  /context:prime

  每次开始工作时都要运行这个命令，让 Claude 了解项目当前状态。

  🎯 开始你的第一个 CCPM 项目

  现在让我们为你的 AI 图片生成项目创建完整的规划：

  1. 创建产品需求文档 (PRD)

  # 开始创建 AI 图片生成项目的 PRD
  /pm:prd-new ai-image-generator

  这会启动一个交互式头脑风暴过程，系统会引导你思考：

  - 项目愿景：通用 AI 图片生成工具
  - 核心功能：文本到图片、图片风格转换、批量生成等
  - 用户故事：用户如何使用这个工具
  - 技术约束：API 限制、性能要求等
  - 成功标准：如何衡量项目成功

  2. 将 PRD 转换为技术实施计划

  # 将 PRD 解析为技术架构
  /pm:prd-parse ai-image-generator

  这会创建：
  - 技术架构设计
  - 模块分解
  - 依赖关系图
  - 实施优先级

  3. 分解为具体任务

  # 将史诗分解为可执行的任务
  /pm:epic-decompose ai-image-generator

  系统会创建具体的任务文件，每个任务包含：
  - 详细描述
  - 验收标准
  - 工作量估算
  - 并行化标志

  4. 同步到 GitHub

  # 将所有任务推送到 GitHub Issues
  /pm:epic-sync ai-image-generator

  # 或者一步完成分解和同步
  /pm:epic-oneshot ai-image-generator

  📋 标准工作流程

  从现在开始，你的每次工作会话都应该遵循这个流程：

  会话开始（每次必做）

  # 1. 加载项目上下文
  /context:prime

  # 2. 检查项目状态
  /pm:status

  # 3. 获取下一个优先任务
  /pm:next

  开始具体任务

  # 开始某个具体 issue
  /pm:issue-start 1234  # 替换为实际的 issue 号

  # 这会启动专门的代理来处理这个任务
  # 代理会自动加载相关上下文

  工作过程中

  # 重大修改后更新上下文
  /context:update

  # 定期同步进度到 GitHub
  /pm:issue-sync 1234

  会话结束

  # 生成工作总结
  /pm:standup

  # 同步所有进度
  /pm:sync